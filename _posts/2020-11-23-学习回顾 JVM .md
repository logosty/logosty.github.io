---
tags: [summary,java,jvm]
title: 知识总结 jvm
key: summary
pageview: true
comment: true
---
# 类加载过程 
> 加载->验证->准备->解析->初始化
* 加载：通过一个类的完全限定查找此类字节码文件，并利用字节码文件创建一个Class对象。
* 验证：文件格式验证，元数据验证，字节码验证，符号引用验证。
* 准备：为类变量(即static修饰的字段变量)分配内存并且设置该类变量的初始值即0(如static int i=5;这里只将i初始化为0，至于5的值将在初始化时赋值)，这里不包含用final修饰的static，因为final在编译的时候就会分配了，注意这里不会为实例变量分配初始化，类变量会分配在方法区中，而实例变量是会随着对象一起分配到Java堆中。
* 解析：主要将常量池中的符号引用替换为直接引用的过程。符号引用就是一组符号来描述目标，可以是任何字面量，而直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄。有类或接口的解析，字段解析，类方法解析，接口方法解析(这里涉及到字节码变量的引用。
* 初始化：类加载最后阶段，若该类具有超类，则对其进行初始化，执行静态初始化器和静态初始化成员变量(如前面只初始化了默认值的static变量将会在这个阶段赋值，成员变量也将被初始化)。
* 使用
* 卸载

# 类加载器
## 启动（Bootstrap）
+ c++ 实现，所以在java代码中get体现为null。负责将 Java_Home/lib下面的类库加载到内存中（比如rt.jar）。
## 扩展（Extension）
+ 是由 Sun 的 ExtClassLoader（sun.misc.Launcher$ExtClassLoader）实现的。它负责将Java_Home /lib/ext或者由系统变量 java.ext.dir指定位置中的类库加载到内存中。
## 系统（App）
+ 是由 Sun 的 AppClassLoader（sun.misc.Launcher$AppClassLoader）实现的。它负责将系统类路径（CLASSPATH）中指定的类库加载到内存中。由于这个类加载器是ClassLoader中的getSystemClassLoader()方法的返回值，因此一般称为系统（System）加载器。
## 自定义(Custom)
+ 开发者自己定义

## 双亲委派模型
+ 出于安全考虑。首先将加载任务委托给父类加载器，依次递归，如果父类加载器可以完成类加载任务，就成功返回；只有父类加载器无法完成此加载任务时，才自己去加载。

## Object o = new Obejct() 的半初始化问题
```
    0 new #2 <java/lang/Object>
    3 dup
    4 invokespecial #1 <java/lang/Object.<init>>
    7 astore_1
    8 return
```
* 发生指令重排序，astore_1 如果在 invokespecial 前执行，就会产生引用到空内存的未初始化对象。