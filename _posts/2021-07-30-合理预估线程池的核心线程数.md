---
tags: [summary,threadPool]
title: 合理预估线程池的核心线程数
key: summary，threadPool
pageview: true
comment: true
---
> 原文链接：https://blog.csdn.net/weixin_40544327/article/details/85702663

## 分析一般从几个角度考虑：

1.任务的性质：CPU密集型的任务、IO密集型任务、混合型任务。

2.任务的优先级：高、中、低

3.任务执行时间：长、中、短

4.任务的依赖性：是否依赖其它系统资源，如数据库的连接等。


## 根据不同的任务可以交给不同规模的线程池执行。

* 如果是cpu密集型的，尽量减少线程数，如果是IO密集型任务尽量加大线程数，因为io不占用cpu的资源。建议配置2倍CPU个数+1。

* 如果是混合型的，尽量根据实际情况进行拆分，根据运行时间来决定。


## 如下为一般计算公式：

* 最佳线程数目 = （（线程等待时间+线程CPU时间）/线程CPU时间 ）* CPU数目

* 最佳线程数目 = （线程等待时间与线程CPU时间之比 + 1）* CPU数目

> 线程等待时间所占比例越高，需要越多线程。线程CPU时间所占比例越高，需要越少线程

## 业务怎样使用线程池？
高并发、任务执行时间短的业务怎样使用线程池？并发不高、任务执行时间长的业务怎样使用线程池？并发高、业务执行时间长的业务怎样使用线程池？

1. 高并发、任务执行时间短的业务，线程池线程数可以设置为CPU核数+1，减少线程上下文的切换

2. 并发不高、任务执行时间长的业务要区分开看：

    * 假如是业务时间长集中在IO操作上，也就是IO密集型的任务，因为IO操作并不占用CPU，所以不要让所有的CPU闲下来，可以适当加大线程池中的线程数目，让CPU处理更多的业务

    * 假如是业务时间长集中在计算操作上，也就是计算密集型任务，这个就没办法了，和（1）一样吧，线程池中的线程数设置得少一些，减少线程上下文的切换

3. 并发高、业务执行时间长，解决这种类型任务的关键不在于线程池而在于整体架构的设计，看看这些业务里面某些数据是否能做缓存是第一步，增加服务器是第二步，至于线程池的设置，设置参考（2）。最后，业务执行时间长的问题，也可能需要分析一下，看看能不能使用中间件对任务进行拆分和解耦。
