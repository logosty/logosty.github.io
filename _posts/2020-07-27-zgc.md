---
tags: [zgc,jvm,garbage collector]
title: zgc
key: blog_zgc
pageview: true
comment: true
---

# 一、背景&简介
Java11 推出的最新垃圾收集器，ZGC，主要为了减少JVM停顿时间。 

ZGC 收集器是一款基于Region内存布局的，（暂时）不设分代的，使用了读屏障、染色指针和内存多重映射等技术来实现可并发的标记-整理算法的，以低延迟为首要目标的一款垃圾收集器。

ZGC 全称是Z Garbage Collector，是一款可伸缩的、低延迟、并发垃圾回收器，旨在实现以下几个目标：

+ 停顿时间不超过10ms
+ 停顿时间不随heap大小或存活对象大小增大而增大
+ 可以处理从几百兆到几T的内存大小（最大4T）

如何减少JVM停顿时间？
1. GC可以在压缩时使用多个线程。（并行压缩）
2. 压缩工作也可以分解为多个阶段。（增量压缩）
3. 将堆压缩，却不停止正在运行的应用程序（或只是短时间停止）。（并发压缩）
4. 完全不压缩。

# 二、ZGC的堆内存布局

+ 目前不分代
+ 与Shenandoah和G1一样，ZGC也采用基于Region的堆内存布局。
+ ZGC的Region具有动态性。
+ 动态创建和销毁
+ 动态的区域容量大小

分类如下：

**小型Region（Small Region）**：容量固定为2MB，用于放置小于256KB的小对象。

**中型Region（Medium Region）**：容量固定为32MB，用于放置大于等于256KB但小于4MB的对象。

**大型Region（Large Region）**：容量不固定，可以动态变化，但必须为2MB的整数倍，用于放置4MB或以上的大对象。每个大型Region中只会存放一个大对象，所以实际容量可能小于中型Region，最小容量可低至4MB。大型Region在ZGC的实现中是不会被重分配的，因为复制一个大对象的代价非常高昂。